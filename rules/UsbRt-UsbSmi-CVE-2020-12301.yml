UsbRt-UsbSmi-CVE-2020-12301:
  meta:
    author: Binarly
    license: https://creativecommons.org/publicdomain/zero/1.0/
    name: UsbRt-UsbSmi-CVE-2020-12301
    version: 1.0
    namespace: vulnerabilities
    CVE number: CVE-2020-12301
    vendor id: INTEL-SA-00367
    CVSS score: 7.5 High
    advisory: https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-00367.html
    description: Detection for SMM callout in USB SMI handler on multiple Intel server platforms
  guids:
    - 0:
      - name: EFI_SMM_USB_DISPATCH2_PROTOCOL_GUID
      - value: EE9B8D90-C5A6-40A2-BDE252558D33CCA1
    - 1:
      - name: EFI_SMM_SW_DISPATCH2_PROTOCOL_GUID
      - value: 18A3C6DC-5EEA-48C8-A1C1B53389F98999
  hex_strings:
    0: 488b3d........32db408ae9389ff8670000
        # Detect part of the following code:
        # UsbData = gUsbData;
        # for ( i = 0; i < *(UsbData + 0x67F8); ++i )
        # 488b3df5060100                      mov     rdi, cs:gUsbData
        # 32db                                xor     bl, bl
        # 408ae9                              mov     bpl, cl
        # 389ff8670000                        cmp     [rdi+67F8h], bl
    1: 488b87f06700000fb6d3488b34d04885f6
        # Detect part of the following code:
        # Ptr = *(*(UsbData + 0x67F0) + 8i64 * i);
        # 488b87f0670000                      mov     rax, [rdi+67F0h]
        # 0fb6d3                              movzx   edx, bl
        # 488b34d0                            mov     rsi, [rax+rdx*8]
        # 4885f6                              test    rsi, rsi
    2: 0fb64601488bce83e8104863d048c1fa044869c2b8000000ff9438a0000000
        # Detect part of the following code:
        # (*(0xB8 * ((*(Ptr + 1) - 16) >> 4) + UsbData + 0xA0))(Ptr);
        # 0fb64601                            movzx   eax, byte ptr [rsi+1]
        # 488bce                              mov     rcx, rsi
        # 83e810                              sub     eax, 10h
        # 4863d0                              movsxd  rdx, eax
        # 48c1fa04                            sar     rdx, 4
        # 4869c2b8000000                      imul    rax, rdx, 0B8h ; 'Â¸'
        # ff9438a0000000                      call    qword ptr [rax+rdi+0A0h]
